import{g as ce,p as me,r as ve,ax as fe,ay as he,D as ge,az as pe,aA as L,F as o,G as z,aB as we,aC as Ve,aD as le,c as G,v as V,s as Ce,e as Fe,o as Pe,w as N,b as Ae,aE as oe,aF as Se,aG as Ie,S as X,a as _e,d as Me,E as v,I as j,aH as Re,aa as ne,aI as Be,aJ as De,ap as Ue,aK as Ne,ad as Te,aL as ze,Y as Ee,_ as s,aM as $e,X as He,Z as re,ai as O,af as Ge,ag as Oe,ac as qe,V as je,ah as q,aw as Le,av as Y,aN as Ke,$ as r,au as Je,ar as Xe,aj as se,at as Ye,aO as Ze}from"./index-D5AbFdb1.js";import{u as Qe,c as We,a as ea,b as Z,d as aa,e as T,V as ta}from"./index.esm-CeQUswTO.js";import{p as Q}from"./product-DBt-vjjm.js";import{V as la,a as ue,b as ie}from"./route-block-DhdQpsR2.js";import{V as oa}from"./VContainer-BkXp5onC.js";import{V as na}from"./VDivider-DMlEPX4j.js";import{a as de,m as ra,V as sa,b as ua}from"./VDataTable-CyIU-EZ6.js";import{V as ia}from"./VToolbar-Dwaicu2W.js";import"./VPagination-CzPggjWa.js";import"./VList-D52y1nIb.js";import"./ssrBoot-B8DZFry5.js";const da=me({...Ve(),...we(ra(),["inline"])},"VCheckbox"),ca=ce()({name:"VCheckbox",inheritAttrs:!1,props:da(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,x){let{attrs:y,slots:k}=x;const i=ve(e,"modelValue"),{isFocused:d,focus:f,blur:_}=fe(e),u=he();return ge(()=>{const[M,R]=pe(y),B=L.filterProps(e),D=de.filterProps(e);return o(L,z({class:["v-checkbox",e.class]},M,B,{modelValue:i.value,"onUpdate:modelValue":g=>i.value=g,id:e.id||`checkbox-${u}`,focused:d.value,style:e.style}),{...k,default:g=>{let{id:h,messagesId:c,isDisabled:w,isReadonly:p,isValid:C}=g;return o(de,z(D,{id:h.value,"aria-describedby":c.value,disabled:w.value,readonly:p.value},R,{error:C.value===!1,modelValue:i.value,"onUpdate:modelValue":F=>i.value=F,onFocus:f,onBlur:_}),k)}})}),{}}}),ma=me({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...Ve(),...Ie()},"VTextarea"),va=ce()({name:"VTextarea",directives:{vIntersect:le},inheritAttrs:!1,props:ma(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,x){let{attrs:y,emit:k,slots:i}=x;const d=ve(e,"modelValue"),{isFocused:f,focus:_,blur:u}=fe(e),{onIntersect:M}=Be(e),R=G(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),B=G(()=>{if(y.maxlength)return y.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter}),D=V(),g=V(),h=Ce(""),c=V(),w=G(()=>e.persistentPlaceholder||f.value||e.active);function p(){var t;c.value!==document.activeElement&&((t=c.value)==null||t.focus()),f.value||_()}function C(t){p(),k("click:control",t)}function F(t){k("mousedown:control",t)}function P(t){t.stopPropagation(),p(),X(()=>{d.value="",Ne(e["onClick:clear"],t)})}function E(t){var S;const b=t.target;if(d.value=b.value,(S=e.modelModifiers)!=null&&S.trim){const U=[b.selectionStart,b.selectionEnd];X(()=>{b.selectionStart=U[0],b.selectionEnd=U[1]})}}const A=V(),n=V(Number(e.rows)),l=G(()=>["plain","underlined"].includes(e.variant));Fe(()=>{e.autoGrow||(n.value=Number(e.rows))});function m(){e.autoGrow&&X(()=>{if(!A.value||!g.value)return;const t=getComputedStyle(A.value),b=getComputedStyle(g.value.$el),S=parseFloat(t.getPropertyValue("--v-field-padding-top"))+parseFloat(t.getPropertyValue("--v-input-padding-top"))+parseFloat(t.getPropertyValue("--v-field-padding-bottom")),U=A.value.scrollHeight,$=parseFloat(t.lineHeight),K=Math.max(parseFloat(e.rows)*$+S,parseFloat(b.getPropertyValue("--v-input-control-height"))),J=parseFloat(e.maxRows)*$+S||1/0,I=Me(U??0,K,J);n.value=Math.floor((I-S)/$),h.value=_e(I)})}Pe(m),N(d,m),N(()=>e.rows,m),N(()=>e.maxRows,m),N(()=>e.density,m);let a;return N(A,t=>{t?(a=new ResizeObserver(m),a.observe(A.value)):a==null||a.disconnect()}),Ae(()=>{a==null||a.disconnect()}),ge(()=>{const t=!!(i.counter||e.counter||e.counterValue),b=!!(t||i.details),[S,U]=pe(y),{modelValue:$,...K}=L.filterProps(e),J=oe.filterProps(e);return o(L,z({ref:D,modelValue:d.value,"onUpdate:modelValue":I=>d.value=I,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":l.value},e.class],style:e.style},S,K,{centerAffix:n.value===1&&!l.value,focused:f.value}),{...i,default:I=>{let{id:H,isDisabled:W,isDirty:ee,isReadonly:xe,isValid:ye}=I;return o(oe,z({ref:g,style:{"--v-textarea-control-height":h.value},onClick:C,onMousedown:F,"onClick:clear":P,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},J,{id:H.value,active:w.value||ee.value,centerAffix:n.value===1&&!l.value,dirty:ee.value||e.dirty,disabled:W.value,focused:f.value,error:ye.value===!1}),{...i,default:be=>{let{props:{class:ae,...te}}=be;return v(j,null,[e.prefix&&v("span",{class:"v-text-field__prefix"},[e.prefix]),ne(v("textarea",z({ref:c,class:ae,value:d.value,onInput:E,autofocus:e.autofocus,readonly:xe.value,disabled:W.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:p,onBlur:u},te,U),null),[[le,{handler:M},null,{once:!0}]]),e.autoGrow&&ne(v("textarea",{class:Ue([ae,"v-textarea__sizer"]),id:`${te.id}-sizer`,"onUpdate:modelValue":ke=>d.value=ke,ref:A,readonly:!0,"aria-hidden":"true"},null),[[De,d.value]]),e.suffix&&v("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:b?I=>{var H;return v(j,null,[(H=i.details)==null?void 0:H.call(i,I),t&&v(j,null,[v("span",null,null),o(Re,{active:e.persistentCounter||f.value,value:R.value,max:B.value,disabled:e.disabled},i.counter)])])}:void 0})}),Se({},D,g,c)}}),fa={class:"px-4"},ga={class:"px-4"},pa={__name:"products",setup(e){const x=Te(),y=V(""),k=V([]),i=[{title:"ID",key:"_id"},{title:"圖片",key:"image",sortable:!1},{title:"名稱",key:"name"},{title:"分類",key:"category"},{title:"價格",key:"price"},{title:"描述",key:"description",sortable:!1},{title:"上架",key:"sell"},{title:"建立日期",key:"createdAt",value:n=>new Date(n.createdAt).toLocaleString()},{title:"更新日期",key:"updatedAt",value:n=>new Date(n.updatedAt).toLocaleString()},{title:"操作",key:"action",sortable:!1}],d=["_id","name","category","price","description","createdAt","updatedAt"],f=async()=>{try{const{data:n}=await Q.getAll();k.value=n.products}catch(n){console.error("Error fetching products:",n),x({text:"無法載入商品資料",snackbarProps:{color:"red"}})}};f();const _=ze("fileAgent"),u=V({open:!1,id:""}),M=n=>{n&&(u.value.id=n._id,c.value.value=n.name,w.value.value=n.price,p.value.value=n.category,C.value.value=n.description,F.value.value=n.sell),u.value.open=!0},R=()=>{u.value.open=!1,u.value.id="",g(),_.value.deleteFileRecord()},B=["電子產品","服裝","家居用品","書籍","玩具","食品","其他"],{handleSubmit:D,resetForm:g,isSubmitting:h}=Qe({validationSchema:We({name:Z().required("商品名稱必填").max(100,"商品名稱最多 100 個字元"),price:aa().typeError("價格必填").required("價格必填").min(0,"價格不能為負數"),category:Z().required("分類必填").oneOf(B,"請選擇有效的分類"),description:Z().max(500,"描述最多 500 個字元"),sell:ea().required("是否上架必填")}),initialValues:{name:"",price:0,category:"",description:"",sell:!1}}),c=T("name"),w=T("price"),p=T("category"),C=T("description"),F=T("sell"),P=V([]),E=V([]),A=D(async n=>{var l,m,a;if((l=P.value[0])!=null&&l.error){x({text:"請選擇有效的圖片檔案",snackbarProps:{color:"red"}});return}if(u.value.id.length===0&&P.value.length===0){x({text:"請上傳商品圖片",snackbarProps:{color:"red"}});return}try{const t=new FormData;t.append("name",n.name),t.append("price",n.price),t.append("category",n.category),t.append("description",n.description),t.append("sell",n.sell),P.value.length>0&&t.append("image",P.value[0].file),await(u.value.id.length===0?Q.create(t):Q.update(u.value.id,t)),x({text:u.value.id.length===0?"商品新增成功！":"商品編輯成功",snackbarProps:{color:"green"}}),f(),R()}catch(t){console.error(t),x({text:((a=(m=t==null?void 0:t.response)==null?void 0:m.data)==null?void 0:a.message)||"操作失敗，請稍後再試！",snackbarProps:{color:"red"}})}});return(n,l)=>{const m=He("VueFileAgent");return re(),Ee(j,null,[o(oa,null,{default:s(()=>[o(la,null,{default:s(()=>[o(ue,{cols:"12"},{default:s(()=>l[10]||(l[10]=[v("h1",{class:"text-center"},"商品管理",-1)])),_:1,__:[10]}),o(na),o(ue,{cols:"12"},{default:s(()=>[o(sa,{"filter-keys":d,headers:i,items:k.value,search:y.value},{top:s(()=>[o(ia,null,{default:s(()=>[v("div",fa,[o(O,{variant:"outlined",onClick:l[0]||(l[0]=a=>M(null))},{default:s(()=>l[11]||(l[11]=[q("新增商品")])),_:1,__:[11]})]),o(Le),v("div",ga,[o(Y,{modelValue:y.value,"onUpdate:modelValue":l[1]||(l[1]=a=>y.value=a),density:"compact",flat:"","hide-details":"",placeholder:"搜尋商品","prepend-inner-icon":"mdi-magnify","single-line":"",variant:"solo",width:"400"},null,8,["modelValue"])])]),_:1})]),"item.image":s(({value:a})=>[o(je,{height:"100",src:a},null,8,["src"])]),"item.sell":s(({value:a})=>[a?(re(),Ge(qe,{key:0,icon:"mdi-check"})):Oe("",!0)]),"item.action":s(({item:a})=>[o(O,{icon:"mdi-pencil",variant:"text",onClick:t=>M(a)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1}),o($e,{modelValue:u.value.open,"onUpdate:modelValue":l[9]||(l[9]=a=>u.value.open=a),width:"600"},{default:s(()=>[o(ta,{disabled:r(h),onSubmit:Ke(r(A),["prevent"])},{default:s(()=>[o(Je,null,{default:s(()=>[o(Xe,null,{default:s(()=>[q(se(u.value.id.length>0?"編輯商品":"新增商品"),1)]),_:1}),o(Ye,null,{default:s(()=>[o(Y,{modelValue:r(c).value.value,"onUpdate:modelValue":l[2]||(l[2]=a=>r(c).value.value=a),"error-messages":r(c).errorMessage.value,label:"名稱"},null,8,["modelValue","error-messages"]),o(Y,{modelValue:r(w).value.value,"onUpdate:modelValue":l[3]||(l[3]=a=>r(w).value.value=a),modelModifiers:{number:!0},"error-messages":r(w).errorMessage.value,label:"價格",min:"0",type:"number"},null,8,["modelValue","error-messages"]),o(ua,{modelValue:r(p).value.value,"onUpdate:modelValue":l[4]||(l[4]=a=>r(p).value.value=a),"error-messages":r(p).errorMessage.value,items:B,label:"分類"},null,8,["modelValue","error-messages"]),o(va,{modelValue:r(C).value.value,"onUpdate:modelValue":l[5]||(l[5]=a=>r(C).value.value=a),"error-messages":r(C).errorMessage.value,label:"描述"},null,8,["modelValue","error-messages"]),o(m,{ref_key:"fileAgent",ref:_,modelValue:P.value,"onUpdate:modelValue":l[6]||(l[6]=a=>P.value=a),"raw-model-value":E.value,"onUpdate:rawModelValue":l[7]||(l[7]=a=>E.value=a),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不正確",size:"檔案大小不超過 1MB"},"help-text":"選擇或拖拽檔案","max-size":"1MB"},null,8,["modelValue","raw-model-value"]),o(ca,{modelValue:r(F).value.value,"onUpdate:modelValue":l[8]||(l[8]=a=>r(F).value.value=a),"error-messages":r(F).errorMessage.value,"hide-details":"",label:"上架"},null,8,["modelValue","error-messages"])]),_:1}),o(Ze,null,{default:s(()=>[o(O,{color:"green",loading:r(h),type:"submit"},{default:s(()=>[q(se(u.value.id.length>0?"編輯":"新增"),1)]),_:1},8,["loading"]),o(O,{color:"red",disabled:r(h),onClick:R},{default:s(()=>l[12]||(l[12]=[q("取消")])),_:1,__:[12]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof ie=="function"&&ie(pa);export{pa as default};
