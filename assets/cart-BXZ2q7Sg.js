import{ad as q,W as B,v as L,c as _,af as v,_ as t,al as V,ae as N,X as P,Z as l,F as e,E as k,Y as y,I as C,a0 as T,ag as D,ah as u,aj as d,aQ as U,V as E,ai as F}from"./index-D5AbFdb1.js";import{o as R}from"./order-Cn8SkuBZ.js";import{V as $,a as i,b}from"./route-block-DhdQpsR2.js";import{V as j}from"./VContainer-BkXp5onC.js";import{V as g}from"./VDivider-DMlEPX4j.js";import{V as A,a as Q,b as W,c as X}from"./VList-D52y1nIb.js";import{V as Y}from"./VNumberInput-Cw9abIPz.js";import"./ssrBoot-B8DZFry5.js";const Z={__name:"cart",setup(z){const c=q(),p=B(),h=N(),s=L([]);(async()=>{try{const{data:r}=await V.getCart();s.value=r.result}catch(r){console.error(r),c({text:"無法獲取購物車資料",snackbarProps:{color:"red"}})}})();const x=async(r,a,n)=>{try{const{data:o}=await V.cart({product:a.product._id,quantity:r-a.quantity});a.quantity=r,r<=0&&s.value.splice(n,1),p.cartTotal=o.result}catch(o){console.error(o),c({text:"更新購物車失敗",snackbarProps:{color:"red"}})}},w=_(()=>s.value.reduce((r,a)=>r+a.product.price*a.quantity,0)),I=_(()=>s.value.length===0||s.value.some(r=>!r.product.sell)),S=async()=>{try{await R.create(),p.cartTotal=0,h.push("/orders")}catch{console.error(error),c({text:"結帳失敗",snackbarProps:{color:"red"}})}};return(r,a)=>{const n=P("router-link");return l(),v(j,null,{default:t(()=>[e($,null,{default:t(()=>[e(i,{col:"12"},{default:t(()=>a[1]||(a[1]=[k("h1",{class:"text-center"},"購物車",-1)])),_:1,__:[1]}),e(g),e(i,{cols:"12"},{default:t(()=>[e(A,{lines:"two"},{default:t(()=>[(l(!0),y(C,null,T(s.value,(o,m)=>(l(),y(C,{key:o._id},[e(Q,{active:!o.product.sell,color:"red"},{prepend:t(()=>[e(U,{class:"cursor-pointer",rounded:"0",onClick:f=>r.$router.push("/product/"+o.product._id)},{default:t(()=>[e(E,{src:o.product.image},null,8,["src"])]),_:2},1032,["onClick"])]),append:t(()=>[e(Y,{"control-variant":"split","hide-details":"",min:0,"model-value":o.quantity,variant:"outlined",width:"150","onUpdate:modelValue":f=>x(f,o,m)},null,8,["model-value","onUpdate:modelValue"])]),default:t(()=>[e(W,{onClick:a[0]||(a[0]=()=>{})},{default:t(()=>[e(n,{class:"text-decoration-none text-white",to:"/product/"+o.product._id},{default:t(()=>[u(d(o.product.name),1)]),_:2},1032,["to"])]),_:2},1024),e(X,null,{default:t(()=>[u(" 價格: "+d(o.product.price)+" 元 ",1)]),_:2},1024)]),_:2},1032,["active"]),m<s.value.length-1?(l(),v(g,{key:0})):D("",!0)],64))),128))]),_:1})]),_:1}),e(i,{class:"text-center",cols:"12"},{default:t(()=>[k("p",null,"總金額："+d(w.value),1),e(F,{class:"mt-3",color:"primary",disabled:I.value,onClick:S},{default:t(()=>a[2]||(a[2]=[u("結帳")])),_:1,__:[2]},8,["disabled"])]),_:1})]),_:1})]),_:1})}}};typeof b=="function"&&b(Z);export{Z as default};
